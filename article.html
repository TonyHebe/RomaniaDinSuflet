<!doctype html>
<html lang="ro">
  <head>
    <!-- Ezoic CMP + header scripts (must load first in <head>) -->
    <script data-cfasync="false" src="https://cmp.gatekeeperconsent.com/min.js"></script>
    <script data-cfasync="false" src="https://the.gatekeeperconsent.com/cmp.min.js"></script>
    <script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
    <script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Articol — Romania Din Suflet</title>
    <meta name="description" content="Articol — Romania Din Suflet" />
    <!-- Ads provider(s): "ezoic" (preferred) or "adsense" -->
    <meta name="ads-provider" content="ezoic" />
    <!-- Ezoic placement IDs (set numeric IDs from Ezoic dashboard) -->
    <meta name="ezoic-article-top-id" content="119" />
    <meta name="ezoic-article-incontent-ids" content="109,110,115" />
    <meta name="ezoic-article-incontent-every" content="3" />
    <meta name="ezoic-article-incontent-start" content="2" />
    <!-- Google AdSense: set to your real ca-pub-... to enable ads -->
    <meta name="adsense-client" content="ca-pub-9846184063862431" />
    <!-- Official AdSense account meta (recommended by Google) -->
    <meta name="google-adsense-account" content="ca-pub-9846184063862431" />
    <!-- AdSense script is injected by ads.js when enabled -->
    <!-- In-article ads (inside article text). Provide one or more numeric slot IDs, comma-separated. -->
    <meta name="adsense-article-incontent-slots" content="REPLACE_ME" />
    <!-- Insert an ad after every N paragraphs (example: 3 = after 3rd, 6th, 9th...). -->
    <meta name="adsense-article-incontent-every" content="3" />
    <!-- Start inserting only after paragraph N (example: 2 = after the 2nd paragraph). -->
    <meta name="adsense-article-incontent-start" content="2" />
    <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./styles.css" />
    <!-- Vercel Web Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
  </head>
  <body>
    <a class="skip-link" href="#main">Sari la conținut</a>

    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="./" aria-label="Romania Din Suflet - Acasă">
          <img
            class="brand-mark"
            src="./assets/logo.svg"
            width="40"
            height="40"
            alt=""
            aria-hidden="true"
          />
          <div class="brand-text">
            <span class="brand-name">Romania</span>
            <span class="brand-sub">Din Suflet</span>
          </div>
        </a>
      </div>
    </header>

    <main id="main" class="site-main">
      <section class="section" aria-labelledby="article-title">
        <div class="container">
          <div class="section-head">
            <h1 class="section-title" id="article-title">Se încarcă…</h1>
            <p class="section-muted" id="article-meta"></p>
          </div>

          <div class="ad-section" data-ad="article_top" aria-label="Publicitate">
            <div class="ad-label" aria-hidden="true">Publicitate</div>
            <div data-ezoic-id-meta="ezoic-article-top-id" hidden></div>
          </div>

          <img
            id="article-image"
            class="article-hero"
            alt=""
            loading="lazy"
            hidden
          />

          <div id="article-content" class="article-content"></div>
          <p class="section-muted" id="article-error" hidden>
            Nu am putut încărca articolul.
          </p>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p class="footer-brand">Romania Din Suflet</p>
        <p class="footer-muted">
          © <span id="year"></span> Toate drepturile rezervate. | 
          <a href="./privacy.html" style="color: inherit; text-decoration: underline;">Politica de Confidențialitate</a>
        </p>
      </div>
    </footer>

    <script>
      (() => {
        const yearEl = document.getElementById("year");
        if (yearEl) yearEl.textContent = String(new Date().getFullYear());

        const titleEl = document.getElementById("article-title");
        const metaEl = document.getElementById("article-meta");
        const contentEl = document.getElementById("article-content");
        const imageEl = document.getElementById("article-image");
        const errorEl = document.getElementById("article-error");

        const params = new URLSearchParams(location.search);
        const slug = params.get("slug");

        if (!slug) {
          if (errorEl) errorEl.hidden = false;
          return;
        }

        function escapeHtml(str) {
          return String(str)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
        }

        function getMetaContent(name) {
          const el = document.querySelector(`meta[name="${CSS.escape(name)}"]`);
          return el instanceof HTMLMetaElement ? (el.content || "").trim() : "";
        }

        function getInContentAdConfig() {
          const idsRaw = getMetaContent("ezoic-article-incontent-ids");
          const everyRaw = getMetaContent("ezoic-article-incontent-every");
          const startRaw = getMetaContent("ezoic-article-incontent-start");

          const ids = idsRaw
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean)
            .map((s) => Number.parseInt(s, 10))
            .filter((n) => Number.isFinite(n) && n > 0);

          const every = Number.parseInt(String(everyRaw || "3"), 10);
          const start = Number.parseInt(String(startRaw || "2"), 10);

          return {
            ids,
            every: Number.isFinite(every) && every > 0 ? every : 3,
            start: Number.isFinite(start) && start > 0 ? start : 2,
          };
        }

        function renderInContentAd({ placementId }) {
          // Hidden by default; ezoic-placements.js will unhide once a valid placement id is set.
          return `
            <div class="ad-section ad-incontent" data-ad="article_incontent" aria-label="Publicitate">
              <div class="ad-label" aria-hidden="true">Publicitate</div>
              <div data-ezoic-placement-id="${escapeHtml(String(placementId))}" hidden></div>
            </div>
          `;
        }

        function maybeInitAds() {
          const fn = window.__RDS_EZOIC_SHOW_ADS;
          if (typeof fn === "function") {
            try {
              fn(document);
            } catch {
              // Ignore (ad blockers, CSP, etc). Site should still function.
            }
          }
        }

        async function load() {
          try {
            const res = await fetch(`/api/articles/${encodeURIComponent(slug)}`, {
              headers: { Accept: "application/json" },
            });
            const contentType = String(res.headers.get("content-type") || "").toLowerCase();
            let a = null;
            if (contentType.includes("application/json")) {
              a = await res.json().catch(() => null);
            } else {
              const text = await res.text().catch(() => "");
              throw new Error(
                `Non-JSON response from /api/articles/:slug (status=${res.status}, content-type=${contentType}): ${text.slice(
                  0,
                  200,
                )}`,
              );
            }
            if (!res.ok) {
              const apiErr = typeof a?.error === "string" ? a.error : "";
              throw new Error(`HTTP ${res.status}${apiErr ? `: ${apiErr}` : ""}`);
            }

            if (titleEl) titleEl.textContent = a?.title || "Articol";
            if (metaEl) {
              metaEl.textContent = a?.publishedAt
                ? new Date(a.publishedAt).toLocaleDateString("ro-RO", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })
                : "";
            }

            if (imageEl && a?.imageUrl) {
              imageEl.src = a.imageUrl;
              imageEl.hidden = false;
            }

            // Body is stored as plain text; render safe paragraphs.
            const body = String(a?.content || "");
            const rawParagraphs = body
              .split(/\n{2,}/g)
              .map((p) => p.trim())
              .filter(Boolean);

            const { ids, every, start } = getInContentAdConfig();
            const parts = [];
            let slotIndex = 0;

            for (let i = 0; i < rawParagraphs.length; i += 1) {
              parts.push(`<p>${escapeHtml(rawParagraphs[i])}</p>`);

              const paragraphNumber = i + 1;
              const canInsert = ids.length > 0 && paragraphNumber >= start && i !== rawParagraphs.length - 1;
              const shouldInsert = canInsert && (paragraphNumber - start + 1) % every === 0;
              if (shouldInsert) {
                const placementId = ids[slotIndex % ids.length];
                slotIndex += 1;
                parts.push(renderInContentAd({ placementId }));
              }
            }

            if (contentEl) contentEl.innerHTML = parts.join("") || "<p></p>";
            maybeInitAds();
          } catch (e) {
            console.error("Failed to load article.", e);
            if (errorEl) errorEl.textContent = "Nu am putut încărca articolul. Te rugăm reîncearcă mai târziu.";
            if (errorEl) errorEl.hidden = false;
          }
        }

        load();
      })();
    </script>
    <script src="./ezoic-placements.js" defer></script>
  </body>
</html>

