<!doctype html>
<html lang="ro">
  <head>
    <!-- In-Page Push (Banner) Ad Script -->
    <script src="https://3nbf4.com/act/files/tag.min.js?z=10607263" data-cfasync="false" async></script>
    <!-- Vignette Banner Ad Script -->
    <script>(function(s){s.dataset.zone='10607270',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <!-- Push Notifications Ad Script -->
    <script>(function(s){s.dataset.zone='10607271',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Articol — Romania Din Suflet</title>
    <meta name="description" content="Articol — Romania Din Suflet" />
    <!-- Google AdSense: set to your real ca-pub-... to enable ads -->
    <meta name="adsense-client" content="ca-pub-9846184063862431" />
    <!-- Official AdSense account meta (recommended by Google) -->
    <meta name="google-adsense-account" content="ca-pub-9846184063862431" />
    <!-- AdSense script is injected by ads.js when enabled -->
    <!-- In-article ads (inside article text). Provide one or more numeric slot IDs, comma-separated. -->
    <meta name="adsense-article-incontent-slots" content="REPLACE_ME" />
    <!-- Insert an ad after every N paragraphs (example: 3 = after 3rd, 6th, 9th...). -->
    <meta name="adsense-article-incontent-every" content="3" />
    <!-- Start inserting only after paragraph N (example: 2 = after the 2nd paragraph). -->
    <meta name="adsense-article-incontent-start" content="2" />
    <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./styles.css" />
    <!-- Vercel Web Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
  </head>
  <body>
    <a class="skip-link" href="#main">Sari la conținut</a>

    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="./" aria-label="Romania Din Suflet - Acasă">
          <img
            class="brand-mark"
            src="./assets/logo.svg"
            width="40"
            height="40"
            alt=""
            aria-hidden="true"
          />
          <div class="brand-text">
            <span class="brand-name">Romania</span>
            <span class="brand-sub">Din Suflet</span>
          </div>
        </a>
      </div>
    </header>

    <main id="main" class="site-main">
      <section class="section" aria-labelledby="article-title">
        <div class="container">
          <div class="section-head">
            <h1 class="section-title" id="article-title">Se încarcă…</h1>
            <p class="section-muted" id="article-meta"></p>
          </div>


          <img
            id="article-image"
            class="article-hero"
            alt=""
            loading="lazy"
            hidden
          />

          <div id="article-content" class="article-content"></div>
          <p class="section-muted" id="article-error" hidden>
            Nu am putut încărca articolul.
          </p>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p class="footer-brand">Romania Din Suflet</p>
        <p class="footer-muted">
          © <span id="year"></span> Toate drepturile rezervate. | 
          <a href="./privacy.html" style="color: inherit; text-decoration: underline;">Politica de Confidențialitate</a>
        </p>
      </div>
    </footer>

    <script>
      (() => {
        const yearEl = document.getElementById("year");
        if (yearEl) yearEl.textContent = String(new Date().getFullYear());

        const titleEl = document.getElementById("article-title");
        const metaEl = document.getElementById("article-meta");
        const contentEl = document.getElementById("article-content");
        const imageEl = document.getElementById("article-image");
        const errorEl = document.getElementById("article-error");

        const params = new URLSearchParams(location.search);
        const slug = params.get("slug");

        if (!slug) {
          if (errorEl) errorEl.hidden = false;
          return;
        }

        function escapeHtml(str) {
          return String(str)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
        }

        function getMetaContent(name) {
          const el = document.querySelector(`meta[name="${CSS.escape(name)}"]`);
          return el instanceof HTMLMetaElement ? (el.content || "").trim() : "";
        }


        async function load() {
          try {
            const res = await fetch(`/api/articles/${encodeURIComponent(slug)}`, {
              headers: { Accept: "application/json" },
            });
            const contentType = String(res.headers.get("content-type") || "").toLowerCase();
            let a = null;
            if (contentType.includes("application/json")) {
              a = await res.json().catch(() => null);
            } else {
              const text = await res.text().catch(() => "");
              throw new Error(
                `Non-JSON response from /api/articles/:slug (status=${res.status}, content-type=${contentType}): ${text.slice(
                  0,
                  200,
                )}`,
              );
            }
            if (!res.ok) {
              const apiErr = typeof a?.error === "string" ? a.error : "";
              throw new Error(`HTTP ${res.status}${apiErr ? `: ${apiErr}` : ""}`);
            }

            if (titleEl) titleEl.textContent = a?.title || "Articol";
            if (metaEl) {
              metaEl.textContent = a?.publishedAt
                ? new Date(a.publishedAt).toLocaleDateString("ro-RO", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })
                : "";
            }

            if (imageEl && a?.imageUrl) {
              imageEl.src = a.imageUrl;
              imageEl.hidden = false;
            }

            // Body is stored as plain text; render safe paragraphs.
            const body = String(a?.content || "");
            const rawParagraphs = body
              .split(/\n{2,}/g)
              .map((p) => p.trim())
              .filter(Boolean);

            const parts = rawParagraphs.map((p) => `<p>${escapeHtml(p)}</p>`);

            if (contentEl) contentEl.innerHTML = parts.join("") || "<p></p>";
          } catch (e) {
            console.error("Failed to load article.", e);
            if (errorEl) errorEl.textContent = "Nu am putut încărca articolul. Te rugăm reîncearcă mai târziu.";
            if (errorEl) errorEl.hidden = false;
          }
        }

        load();
      })();
    </script>
  </body>
</html>

